// Generated by Qleany. Edit at your own risk! Be careful when regenerating this file
// as changes will be lost.

use crate::units_of_work::add_customer_uow::AddCustomerUnitOfWorkFactory;
use crate::units_of_work::list_customers_uow::ListCustomersUnitOfWorkFactory;
use crate::use_cases::add_customer_uc::AddCustomerUseCase;
use crate::use_cases::list_customers_uc::ListCustomersUseCase;
use crate::AddCustomerDto;
use crate::AddCustomerReturnDto;
use crate::CustomerListDto;
use anyhow::Result;
use common::event::{Event, Origin};

use common::event::CustomerManagementEvent::AddCustomer;
use common::event::CustomerManagementEvent::ListCustomers;

use common::{database::db_context::DbContext, event::EventHub};
use std::sync::Arc;

pub fn list_customers(
    db_context: &DbContext,
    event_hub: &Arc<EventHub>,
) -> Result<CustomerListDto> {
    let uow_context = ListCustomersUnitOfWorkFactory::new(&db_context);
    let mut uc = ListCustomersUseCase::new(Box::new(uow_context));
    let return_dto = uc.execute()?;
    // Notify that the handling manifest has been loaded
    event_hub.send_event(Event {
        origin: Origin::CustomerManagement(ListCustomers),
        ids: vec![],
        data: None,
    });
    Ok(return_dto)
}

pub fn add_customer(
    db_context: &DbContext,
    event_hub: &Arc<EventHub>,
    dto: &AddCustomerDto,
) -> Result<AddCustomerReturnDto> {
    let uow_context = AddCustomerUnitOfWorkFactory::new(&db_context, &event_hub);
    let mut uc = AddCustomerUseCase::new(Box::new(uow_context));
    let return_dto = uc.execute(dto)?;
    // Notify that the handling manifest has been loaded
    event_hub.send_event(Event {
        origin: Origin::CustomerManagement(AddCustomer),
        ids: vec![],
        data: None,
    });
    Ok(return_dto)
}
