// Generated by Qleany. Edit at your own risk! Be careful when regenerating this file
// as changes will be lost.

use crate::units_of_work::add_car_uow::AddCarUnitOfWorkFactory;
use crate::units_of_work::list_cars_uow::ListCarsUnitOfWorkFactory;
use crate::units_of_work::sell_car_uow::SellCarUnitOfWorkFactory;
use crate::use_cases::add_car_uc::AddCarUseCase;
use crate::use_cases::list_cars_uc::ListCarsUseCase;
use crate::use_cases::sell_car_uc::SellCarUseCase;
use crate::AddCarDto;
use crate::AddCarReturnDto;
use crate::CarListDto;
use crate::SellCarDto;
use crate::SellCarReturnDto;
use anyhow::Result;
use common::event::{Event, Origin};

use common::event::CarManagementEvent::AddCar;
use common::event::CarManagementEvent::ListCars;
use common::event::CarManagementEvent::SellCar;

use common::{database::db_context::DbContext, event::EventHub};
use std::sync::Arc;

pub fn list_cars(db_context: &DbContext, event_hub: &Arc<EventHub>) -> Result<CarListDto> {
    let uow_context = ListCarsUnitOfWorkFactory::new(&db_context);
    let mut uc = ListCarsUseCase::new(Box::new(uow_context));
    let return_dto = uc.execute()?;
    // Notify that the handling manifest has been loaded
    event_hub.send_event(Event {
        origin: Origin::CarManagement(ListCars),
        ids: vec![],
        data: None,
    });
    Ok(return_dto)
}

pub fn add_car(
    db_context: &DbContext,
    event_hub: &Arc<EventHub>,
    dto: &AddCarDto,
) -> Result<AddCarReturnDto> {
    let uow_context = AddCarUnitOfWorkFactory::new(&db_context, &event_hub);
    let mut uc = AddCarUseCase::new(Box::new(uow_context));
    let return_dto = uc.execute(dto)?;
    // Notify that the handling manifest has been loaded
    event_hub.send_event(Event {
        origin: Origin::CarManagement(AddCar),
        ids: vec![],
        data: None,
    });
    Ok(return_dto)
}

pub fn sell_car(
    db_context: &DbContext,
    event_hub: &Arc<EventHub>,
    dto: &SellCarDto,
) -> Result<SellCarReturnDto> {
    let uow_context = SellCarUnitOfWorkFactory::new(&db_context, &event_hub);
    let mut uc = SellCarUseCase::new(Box::new(uow_context));
    let return_dto = uc.execute(dto)?;
    // Notify that the handling manifest has been loaded
    event_hub.send_event(Event {
        origin: Origin::CarManagement(SellCar),
        ids: vec![],
        data: None,
    });
    Ok(return_dto)
}
