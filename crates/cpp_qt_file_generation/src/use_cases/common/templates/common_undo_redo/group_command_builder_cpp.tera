#include "group_command_builder.h"

namespace {{ s.global.application_pascal_name }}::Common::UndoRedo
{

GroupCommandBuilder::GroupCommandBuilder(const QString &text)
    : m_text(text)
{
}

GroupCommandBuilder& GroupCommandBuilder::addCommand(std::shared_ptr<UndoRedoCommand> command)
{
    if (command) {
        m_commands.append(command);
    }
    return *this;
}

GroupCommandBuilder& GroupCommandBuilder::insertCommand(int index, std::shared_ptr<UndoRedoCommand> command)
{
    if (command && index >= 0 && index <= m_commands.size()) {
        m_commands.insert(index, command);
    }
    return *this;
}

GroupCommandBuilder& GroupCommandBuilder::onFailure(FailureStrategy strategy)
{
    m_failureStrategy = strategy;
    return *this;
}

GroupCommandBuilder& GroupCommandBuilder::setParent(QObject *parent)
{
    m_parent = parent;
    return *this;
}

std::shared_ptr<GroupCommand> GroupCommandBuilder::build()
{
    auto groupCommand = std::make_shared<GroupCommand>(m_text, m_parent);
    
    // Add all commands to the group
    for (const auto& command : m_commands) {
        groupCommand->addCommand(command);
    }
    
    // Set failure strategy (we'll need to extend GroupCommand to support this)
    groupCommand->setFailureStrategy(m_failureStrategy);
    
    return groupCommand;
}

} // namespace {{ s.global.application_pascal_name }}::Common::UndoRedo