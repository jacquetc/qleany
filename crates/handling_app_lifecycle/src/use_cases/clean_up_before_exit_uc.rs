// Generated by Qleany. Edit at your own risk! Be careful when regenerating this file
// as changes will be lost.
use anyhow::{anyhow, Result};
use common::database::CommandUnitOfWork;
use common::entities::Root;
use common::types::EntityId;

pub trait CleanUpBeforeExitUnitOfWorkFactoryTrait {
    fn create(&self) -> Box<dyn CleanUpBeforeExitUnitOfWorkTrait>;
}

#[macros::uow_action(entity = "Root", action = "Delete")]
pub trait CleanUpBeforeExitUnitOfWorkTrait: CommandUnitOfWork {}

pub struct CleanUpBeforeExitUseCase {
    uow_factory: Box<dyn CleanUpBeforeExitUnitOfWorkFactoryTrait>,
}

impl CleanUpBeforeExitUseCase {
    pub fn new(uow_factory: Box<dyn CleanUpBeforeExitUnitOfWorkFactoryTrait>) -> Self {
        CleanUpBeforeExitUseCase { uow_factory }
    }

    pub fn execute(&mut self) -> Result<()> {
        let mut uow = self.uow_factory.create();
        uow.begin_transaction()?;

        uow.delete_root(&0)?;

        uow.commit()?;
        Ok(())
    }
}
