// Generated by Qleany. Edit at your own risk! Be careful when regenerating this file
// as changes will be lost.
use anyhow::Result;
use common::database::CommandUnitOfWork;
use common::entities::{Root, System};

pub trait InitializeAppUnitOfWorkFactoryTrait {
    fn create(&self) -> Box<dyn InitializeAppUnitOfWorkTrait>;
}
#[macros::uow_action(entity = "Root", action = "Create")]
#[macros::uow_action(entity = "System", action = "Create")]
pub trait InitializeAppUnitOfWorkTrait: CommandUnitOfWork {}

pub struct InitializeAppUseCase {
    uow_factory: Box<dyn InitializeAppUnitOfWorkFactoryTrait>,
}

impl InitializeAppUseCase {
    pub fn new(uow_factory: Box<dyn InitializeAppUnitOfWorkFactoryTrait>) -> Self {
        InitializeAppUseCase { uow_factory }
    }

    pub fn execute(&mut self) -> Result<()> {
        let mut uow = self.uow_factory.create();
        uow.begin_transaction()?;

        // create system
        let system = uow.create_system(&System {
            id: 0,
            files: vec![],
        })?;

        uow.create_root(&Root {
            id: 0,
            workspace: None,
            system: Some(system.id),
        })?;

        uow.commit()?;
        Ok(())
    }
}
