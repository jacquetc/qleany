// Generated by Qleany. Edit at your own risk! Be careful when regenerating this file
// as changes will be lost.

use crate::units_of_work::clean_up_before_exit_uow::CleanUpBeforeExitUnitOfWorkFactory;
use crate::units_of_work::initialize_app_uow::InitializeAppUnitOfWorkFactory;
use crate::use_cases::clean_up_before_exit_uc::CleanUpBeforeExitUseCase;
use crate::use_cases::initialize_app_uc::InitializeAppUseCase;
use anyhow::Result;
use common::event::{Event, Origin};

use common::event::HandlingAppLifecycleEvent::CleanUpBeforeExit;
use common::event::HandlingAppLifecycleEvent::InitializeApp;

use common::{database::db_context::DbContext, event::EventHub};
use std::sync::Arc;

pub fn initialize_app(db_context: &DbContext, event_hub: &Arc<EventHub>) -> Result<()> {
    let uow_context = InitializeAppUnitOfWorkFactory::new(&db_context, &event_hub);
    let mut uc = InitializeAppUseCase::new(Box::new(uow_context));
    let return_dto = uc.execute()?;
    // Notify that the handling manifest has been loaded
    event_hub.send_event(Event {
        origin: Origin::HandlingAppLifecycle(InitializeApp),
        ids: vec![],
        data: None,
    });
    Ok(return_dto)
}

pub fn clean_up_before_exit(db_context: &DbContext, event_hub: &Arc<EventHub>) -> Result<()> {
    let uow_context = CleanUpBeforeExitUnitOfWorkFactory::new(&db_context, &event_hub);
    let mut uc = CleanUpBeforeExitUseCase::new(Box::new(uow_context));
    let return_dto = uc.execute()?;
    // Notify that the handling manifest has been loaded
    event_hub.send_event(Event {
        origin: Origin::HandlingAppLifecycle(CleanUpBeforeExit),
        ids: vec![],
        data: None,
    });
    Ok(return_dto)
}
